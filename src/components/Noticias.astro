---
import { Image } from "astro:assets";
import NoticiasImg from "../assets/images/noticias.webp";
import NoticiasMobileImg from "../assets/images/noticias_mmobile.webp";

import { newsCards } from "../data/news.ts";

// Función para convertir títulos a slugs URL-friendly (debe coincidir con [slug].astro)
function slugify(text: string): string {
    return text
        .toString()
        .normalize("NFD") // Normalizar caracteres Unicode
        .replace(/[\u0300-\u036f]/g, "") // Eliminar acentos
        .toLowerCase()
        .trim()
        .replace(/\s+/g, "-") // Reemplazar espacios con guiones
        .replace(/[^\w\-]+/g, "") // Eliminar caracteres especiales
        .replace(/\-\-+/g, "-") // Reemplazar múltiples guiones con uno solo
        .replace(/^-+/, "") // Eliminar guiones al inicio
        .replace(/-+$/, ""); // Eliminar guiones al final
}
---

<section
    class="relative py-8 sm:py-10 md:py-14 overflow-hidden min-h-[90VH] md:h-[900px]"
    id="noticias"
>
    <!-- Background con picture element -->
    <picture class="absolute inset-0 z-0">
        <source media="(max-width: 767px)" srcset={NoticiasMobileImg.src} />
        <img
            src={NoticiasImg.src}
            alt="Noticias sobre Copiapoa"
            class="w-full h-full object-cover object-bottom"
        />
    </picture>

    <div class="container mx-auto relative z-10 px-4">
        <div class="flex flex-col items-center justify-center py-8 sm:py-10 md:py-[60px]">
            <h1
                class="font-rubik text-xc-azul text-center text-2xl sm:text-3xl md:text-[38px] leading-tight md:leading-[44px] font-normal"
            >
                ¿QUÉ HACEMOS?
            </h1>
        </div>
        <div class="flex flex-wrap gap-4 sm:gap-6 items-center justify-center">
            {
                newsCards.map((card) => (
                    <div class="border-[1px] border-xc-azul rounded-[22px] bg-white p-4 sm:p-5 md:p-[20px] w-full sm:w-[calc(50%-0.75rem)] lg:w-[460px] min-h-[450px] sm:min-h-[482px] md:h-[482px] gap-y-4 sm:gap-y-5 md:gap-y-[20px] flex flex-col">
                        <Image
                            src={card.image}
                            alt={card.title}
                            width={2000}
                            height={1333}
                            class="rounded-[10px] w-full h-[140px] sm:h-[160px] md:w-[420px] md:h-[160px] object-cover bg-cover object-center"
                        />
                        <p class="text-[#8B8B8B] text-xs sm:text-sm md:text-[14px] font-manrope leading-normal">
                            {card.date}
                        </p>
                        <h5 class="text-negro font-manrope text-base sm:text-lg md:text-[18px] leading-tight md:leading-[28px] font-bold ">
                            {card.title}
                        </h5>
                        <p class="text-negro font-manrope text-[16px] font-normal leading-normal flex-grow">
                            {card.extract.slice(0, 158)}...
                        </p>
                        <a
                            href={`/noticias/${slugify(card.title)}`}
                            class="bg-xc-azul text-center text-white rounded-[35px] py-3 px-6 md:p-[10px] font-manrope text-[16px] leading-normal font-normal hover:bg-xc-azul/75 active:bg-xc-azul/90 transition-colors min-h-[44px] flex items-center justify-center"
                        >
                            Leer más
                        </a>
                    </div>
                ))
            }
        </div>
    </div>
</section>
