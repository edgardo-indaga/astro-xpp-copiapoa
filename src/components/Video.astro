---
/**
 * Componente Video con integración de Cloudinary
 *
 * Uso:
 * <Video
 *   src="nombre-del-video"
 *   width={1920}
 *   height={1080}
 * />
 *
 * El 'src' debe ser el Public ID del video en Cloudinary
 * (por ejemplo: "videos/mi-video" o "mi-video")
 */

import { CldVideoPlayer } from "astro-cloudinary";

interface Props {
    /** Public ID del video en Cloudinary */
    src: string;

    /** Ancho del video en píxeles */
    width?: number;

    /** Alto del video en píxeles */
    height?: number;

    /** Reproducir automáticamente al cargar */
    autoplay?: boolean;

    /** Silenciar el audio */
    muted?: boolean;

    /** Repetir el video en bucle */
    loop?: boolean;

    /** Mostrar controles de reproducción */
    controls?: boolean;

    /** URL o configuración del poster/thumbnail */
    poster?: string;

    /** Clase CSS adicional para el contenedor */
    className?: string;
}

const {
    src,
    width = 1920,
    height = 1080,
    autoplay = false,
    muted = false,
    loop = false,
    controls = true,
    poster,
    className = "",
} = Astro.props;

// Transformaciones para optimización automática
const transformation = {
    quality: "auto", // Cloudinary optimiza la calidad automáticamente
    fetch_format: "auto", // Selecciona el mejor formato/codec automáticamente
};
---

<section class="bg-xc-hueso py-8 sm:py-12 md:py-[70px] h-auto min-h-[400px] sm:min-h-[500px] md:h-[800px]">
    <div class="container mx-auto px-4">
        <div class={`relative w-full max-w-full ${className}`}>
            <CldVideoPlayer
                src={src}
                width={width}
                height={height}
                autoplay={autoplay}
                muted={muted}
                loop={loop}
                controls={controls}
                poster={poster}
                transformation={transformation}
            />
        </div>
    </div>
</section>

<style is:global>
    /* Hace que el video player de Cloudinary sea responsivo */
    .cld-video-player,
    .cld-video-player video {
        width: 100% !important;
        height: auto !important;
    }

    /* En mobile, hacer el video más cuadrado para ocupar más espacio */
    @media (max-width: 767px) {
        .cld-video-player {
            aspect-ratio: 4 / 5 !important;
        }

        .cld-video-player video {
            height: 100% !important;
            object-fit: cover !important;
        }
    }

    /* ============================================
       PERSONALIZACIÓN DEL BOTÓN DE PLAY
       Borde blanco 4px, fondo transparente
       ============================================ */

    /* Base del botón de play */
    .vjs-big-play-button {
        /* Estructura visual */
        border: 4px solid #ffffff !important;
        background-color: transparent !important;
        border-radius: 50%; /* Botón circular */

        /* Tamaño responsivo */
        width: 60px !important;
        height: 60px !important;

        /* Posicionamiento centrado fijo */
        position: absolute !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;

        /* Eliminar márgenes y paddings */
        margin: 0 !important;
        padding: 0 !important;

        /* Eliminar sombras default */
        box-shadow: none !important;

        /* Display y alineación */
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;

        /* Optimización de rendimiento */
        will-change: transform;

        /* Transiciones suaves */
        transition: all 0.3s ease-in-out;
    }

    /* Tamaños responsivos del botón */
    @media (min-width: 640px) {
        .vjs-big-play-button {
            width: 80px !important;
            height: 80px !important;
            border-width: 5px !important;
        }
    }

    @media (min-width: 768px) {
        .vjs-big-play-button {
            width: 100px !important;
            height: 100px !important;
            border-width: 6px !important;
        }
    }

    /* Estados hover */
    .vjs-big-play-button:hover,
    .video-js:hover .vjs-big-play-button,
    .vjs-big-play-button:focus {
        background-color: transparent !important;
        opacity: 0.85;
        transform: translate(-50%, -50%) scale(1.1) !important;
        border-color: #ffffff !important;
    }

    /* Ícono de play (triángulo) */
    .vjs-big-play-button .vjs-icon-placeholder::before {
        /* Color del ícono */
        color: #ffffff;

        /* Tamaño del ícono responsivo */
        font-size: 1.5em;

        /* Remover sombras */
        text-shadow: none;

        /* Centrado perfecto del ícono */
        display: block;
        line-height: 1;
    }

    /* Tamaño del ícono en pantallas más grandes */
    @media (min-width: 640px) {
        .vjs-big-play-button .vjs-icon-placeholder::before {
            font-size: 2em;
        }
    }

    @media (min-width: 768px) {
        .vjs-big-play-button .vjs-icon-placeholder::before {
            font-size: 2.5em;
        }
    }

    /* Estado hover del ícono */
    .vjs-big-play-button:hover .vjs-icon-placeholder::before {
        color: #ffffff;
    }
</style>
