---

---

<div class="flex flex-col">
    <form id="contactForm" class="flex flex-col gap-[10px]">
        <div class="form-field">
            <input
                type="text"
                name="name"
                id="name"
                placeholder="Nombre*"
                aria-label="Nombre"
                class="w-full px-4 py-4 md:py-3 min-h-[48px] md:min-h-[44px] border-[1px] border-[#A0A0A0] rounded-[10px] focus:outline-none focus:border-[#A0A0A0] focus:ring-2 focus:ring-offset-2 transition-all duration-200 text-[16px] placeholder:text-[#A0A0A0] font-manrope font-normal text-white"
                required
            />
        </div>
        <div class="form-field">
            <input
                type="email"
                name="email"
                id="email"
                placeholder="Email*"
                aria-label="Email"
                class="w-full px-4 py-4 md:py-3 min-h-[48px] md:min-h-[44px] border-[1px] border-[#A0A0A0] rounded-[10px] focus:outline-none focus:border-[#A0A0A0] focus:ring-2 focus:ring-offset-2 transition-all duration-200 text-[16px] placeholder:text-[#A0A0A0] font-manrope font-normal text-white"
                required
            />
        </div>
        <div class="form-field">
            <textarea
                name="message"
                id="message"
                rows="7"
                placeholder="Mensaje*"
                aria-label="Mensaje"
                class="w-full px-4 py-4 md:py-3 border-[1px] border-[#A0A0A0] rounded-[10px] focus:outline-none focus:border-[#A0A0A0] focus:ring-2 focus:ring-offset-2 transition-all duration-200 text-[16px] placeholder:text-[#A0A0A0] font-manrope font-normal text-white"
                required></textarea>
        </div>
        <div class="flex justify-center">
            <button
                type="submit"
                id="submitBtn"
                class="w-full bg-xc-azul text-white px-8 py-4 md:py-3 min-h-[48px] md:min-h-[44px] rounded-[3px] font-manrope font-normal hover:bg-xc-azul/75 active:scale-95 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed text-[16px] uppercase cursor-pointer rounded-[35px]"
            >
                <span id="buttonText">Enviar</span>
                <span id="buttonLoader" class="hidden">Enviando...</span>
            </button>
        </div>

        <!-- Mensaje de respuesta -->
        <div
            id="formMessage"
            role="alert"
            aria-live="polite"
            class="mt-6 p-4 rounded-sm text-center hidden transition-all duration-300"
        >
        </div>
    </form>
</div>

<script>
    const form = document.getElementById("contactForm") as HTMLFormElement;
    const submitBtn = document.getElementById("submitBtn") as HTMLButtonElement;
    const buttonText = document.getElementById("buttonText") as HTMLSpanElement;
    const buttonLoader = document.getElementById("buttonLoader") as HTMLSpanElement;
    const formMessage = document.getElementById("formMessage") as HTMLDivElement;

    // Variable para prevenir múltiples envíos simultáneos
    let isSubmitting = false;

    // Verificar que todos los elementos existen
    if (!form || !submitBtn || !buttonText || !buttonLoader || !formMessage) {
        console.error("Error: No se encontraron todos los elementos del formulario");
    }

    form?.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Prevenir múltiples envíos
        if (isSubmitting) {
            return;
        }

        // Validar formulario usando validación nativa del navegador
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        isSubmitting = true;

        // Deshabilitar botón y mostrar loader
        submitBtn.disabled = true;
        buttonText.classList.add("hidden");
        buttonLoader.classList.remove("hidden");
        formMessage.classList.add("hidden");

        // Obtener datos del formulario
        const formData = new FormData(form);

        try {
            // Enviar datos a la API
            const response = await fetch("/api/contact", {
                method: "POST",
                body: formData,
            });

            // Verificar si la respuesta es exitosa (status 200-299)
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }

            const data = await response.json();

            // Mostrar mensaje de respuesta
            formMessage.textContent = data.message || "Mensaje enviado correctamente";
            formMessage.classList.remove("hidden");

            if (data.success) {
                // Éxito: mensaje verde
                formMessage.classList.remove("bg-red-100", "text-red-700", "border-red-400");
                formMessage.classList.add(
                    "bg-green-100",
                    "text-green-700",
                    "border",
                    "border-green-400",
                );

                // Limpiar formulario
                form.reset();
            } else {
                // Error: mensaje rojo
                formMessage.classList.remove("bg-green-100", "text-green-700", "border-green-400");
                formMessage.classList.add("bg-red-100", "text-red-700", "border", "border-red-400");
            }
        } catch (error) {
            // Error de red o servidor
            formMessage.textContent = "Error al enviar el mensaje. Por favor, inténtelo de nuevo.";
            formMessage.classList.remove(
                "hidden",
                "bg-green-100",
                "text-green-700",
                "border-green-400",
            );
            formMessage.classList.add("bg-red-100", "text-red-700", "border", "border-red-400");
            console.error("Error al enviar formulario:", error);
        } finally {
            // Restaurar botón
            submitBtn.disabled = false;
            buttonText.classList.remove("hidden");
            buttonLoader.classList.add("hidden");
            isSubmitting = false;

            // Ocultar mensaje después de 5 segundos
            setTimeout(() => {
                formMessage.classList.add("hidden");
            }, 5000);
        }
    });
</script>
