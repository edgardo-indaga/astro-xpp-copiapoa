---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Slide {
    image: string | ImageMetadata;
    alt: string;
}

interface Props {
    slides: Slide[];
    title: string;
    buttonText: string;
    buttonLink?: string;
    autoPlayInterval?: number; // en milisegundos, default: 5000
}

const { slides, title, buttonText, buttonLink = "#", autoPlayInterval = 5000 } = Astro.props;
---

<div class="slider-container relative w-full h-[calc(100vh-130px)] overflow-hidden">
    <!-- Slides -->
    <div class="slides-wrapper relative w-full h-full">
        {
            slides.map((slide, index) => (
                <div
                    class:list={[
                        "slide absolute inset-0 transition-opacity duration-[1500ms] ease-in-out",
                        index === 0 ? "opacity-100 z-10" : "opacity-0 z-0",
                    ]}
                    data-slide-index={index}
                >
                    {typeof slide.image === "string" ? (
                        <img src={slide.image} alt={slide.alt} class="w-full h-full object-cover" />
                    ) : (
                        <Image
                            src={slide.image}
                            alt={slide.alt}
                            class="w-full h-full object-cover"
                            widths={[400, 800, 1200, 1600, 2000]}
                            sizes="100vw"
                            loading={index === 0 ? "eager" : "lazy"}
                        />
                    )}
                    <div class="absolute inset-0 bg-black/30" />
                </div>
            ))
        }
    </div>

    <!-- Contenido superpuesto -->
    <div
        class="absolute inset-0 z-20 flex flex-col items-start justify-center px-6 md:px-12 lg:px-20"
    >
        <div class="container mx-auto">
            <h1
                class="text-[40px] font-bold text-white mb-8 max-w-[600px] leading-[44px] font-rubik tracking-normal"
            >
                {title}
            </h1>
            <a
                href={buttonLink}
                class="inline-block px-8 py-3 border-2 border-white text-white font-medium rounded-full hover:bg-white hover:text-gray-900 transition-all duration-300 ease-in-out font-manrope text-[20px]"
            >
                {buttonText}
            </a>
        </div>
    </div>

    <!-- Indicadores de navegación (dots) - posicionados desde abajo -->
    <div class="absolute bottom-50 left-0 right-0 z-20 px-6 md:px-12 lg:px-20">
        <div class="container mx-auto">
            <div class="flex gap-2">
                {
                    slides.map((_, index) => (
                        <button
                            class:list={[
                                "dot h-3 rounded-full transition-all duration-500 ease-in-out",
                                index === 0 ? "w-8 bg-white" : "w-3 bg-white/50",
                            ]}
                            data-dot-index={index}
                            aria-label={`Ir a la imagen ${index + 1}`}
                        />
                    ))
                }
            </div>
        </div>
    </div>
</div>

<script is:inline define:vars={{ autoPlayInterval }}>
    class Slider {
        constructor() {
            this.currentIndex = 0;
            this.slides = document.querySelectorAll(".slide");
            this.dots = document.querySelectorAll(".dot");
            this.container = document.querySelector(".slider-container");
            this.autoPlayTimer = null;
            this.isAutoPlayPaused = false;

            this.init();
        }

        init() {
            // Event listeners para los dots
            this.dots.forEach((dot, index) => {
                dot.addEventListener("click", () => {
                    this.goToSlide(index);
                    this.pauseAutoPlay();
                    this.restartAutoPlay();
                });
            });

            // Pausar autoplay al hacer hover
            this.container.addEventListener("mouseenter", () => {
                this.pauseAutoPlay();
            });

            // Reanudar autoplay al salir del hover
            this.container.addEventListener("mouseleave", () => {
                this.restartAutoPlay();
            });

            // Iniciar autoplay
            this.startAutoPlay();
        }

        goToSlide(index) {
            // Ocultar slide actual
            this.slides[this.currentIndex].classList.remove("opacity-100", "z-10");
            this.slides[this.currentIndex].classList.add("opacity-0", "z-0");

            // Desactivar dot actual (hacerlo más pequeño)
            this.dots[this.currentIndex].classList.remove("bg-white", "w-8");
            this.dots[this.currentIndex].classList.add("bg-white/50", "w-3");

            // Actualizar índice
            this.currentIndex = index;

            // Mostrar nuevo slide
            this.slides[this.currentIndex].classList.remove("opacity-0", "z-0");
            this.slides[this.currentIndex].classList.add("opacity-100", "z-10");

            // Activar nuevo dot (hacerlo más ancho)
            this.dots[this.currentIndex].classList.remove("bg-white/50", "w-3");
            this.dots[this.currentIndex].classList.add("bg-white", "w-8");
        }

        nextSlide() {
            const nextIndex = (this.currentIndex + 1) % this.slides.length;
            this.goToSlide(nextIndex);
        }

        startAutoPlay() {
            this.autoPlayTimer = setInterval(() => {
                if (!this.isAutoPlayPaused) {
                    this.nextSlide();
                }
            }, autoPlayInterval);
        }

        pauseAutoPlay() {
            this.isAutoPlayPaused = true;
        }

        restartAutoPlay() {
            this.isAutoPlayPaused = false;
        }
    }

    // Inicializar slider cuando el DOM esté listo
    if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => {
            new Slider();
        });
    } else {
        new Slider();
    }
</script>
